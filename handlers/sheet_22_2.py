from handlers.handler_base import merge_cells, merge_checkbox_groups, is_page_meaningful

# Placeholder cells to merge (you can update these later)
MERGE_CELLS = [
    # Page 1
    "F7",
    "F8",
    "D19",
    "L26",
    "L27",
    "P27",
    "A9",
    "A10",
    "A11",
    "A12",
    "A13",
    "A14",
    "A15",
    "A16",
    "A17",
    "A18",
    "A19",
    "A20",
    "A21",
    "A22",
    "A23",
    "A24",
    "A25",
    "A26",
    "A27",
    "A28",
    "A29",
    "A30",
    "A31",
    "A32",
    "A33",
    "A34",
    "A35",
    "A36",
    "A37",
    "A38",
    "A39",
    # Page 2
    "F46",
    "F47",
    "D58",
    "L65",
    "L66",
    "P66",
    "A49",
    "A50",
    "A51",
    "A52",
    "A53",
    "A54",
    "A55",
    "A56",
    "A57",
    "A58",
    "A59",
    "A60",
    "A61",
    "A62",
    "A63",
    "A64",
    "A65",
    "A66",
    "A67",
    "A68",
    "A69",
    "A70",
    "A71",
    "A72",
    "A73",
    "A74",
    "A75",
    "A76",
    "A77",
    "A78",
    "A79",
    # Page 3
    "F85",
    "F86",
    "D97",
    "L104",
    "L105",
    "P105",
    "A89",
    "A90",
    "A91",
    "A92",
    "A93",
    "A94",
    "A95",
    "A96",
    "A97",
    "A98",
    "A99",
    "A100",
    "A101",
    "A102",
    "A103",
    "A104",
    "A105",
    "A106",
    "A107",
    "A108",
    "A109",
    "A110",
    "A111",
    "A112",
    "A113",
    "A114",
    "A115",
    "A116",
    "A117",
    "A118",
    "A119",
    # Page 4
    "F124",
    "F125",
    "D136",
    "L143",
    "L144",
    "P144",
    "A129",
    "A130",
    "A131",
    "A132",
    "A133",
    "A134",
    "A135",
    "A136",
    "A137",
    "A138",
    "A139",
    "A140",
    "A141",
    "A142",
    "A143",
    "A144",
    "A145",
    "A146",
    "A147",
    "A148",
    "A149",
    "A150",
    "A151",
    "A152",
    "A153",
    "A154",
    "A155",
    "A156",
    "A157",
    "A158",
    "A159",
]


# Placeholder checkbox groups (YES/NO or YES/NO/N/A)
MERGE_CHECKBOX_GROUPS = [
    # Page 1
    ["L9", "N9"],
    ["L10", "N10", "P10"],
    ["L11", "N11"],
    ["L12", "N12"],
    ["L13", "N13"],
    ["L14", "N14", "P14"],
    ["L15", "N15", "P15"],
    ["L16", "N16", "P16"],
    ["L17", "N17", "P17"],
    ["L18", "N18", "P18"],
    ["L20", "N20", "P20"],
    ["L21", "N21", "P21"],
    ["L22", "N22", "P22"],
    ["L23", "N23", "P23"],
    ["L24", "N24", "P24"],
    ["L25", "N25", "P25"],
    ["N26", "P26"],
    ["L28", "N28"],
    ["L29", "N29", "P29"],
    ["L30", "N30", "P30"],
    ["L31", "N31", "P31"],
    ["L32", "N32", "P32"],
    ["L33", "N33", "P33"],
    ["L34", "N34", "P34"],
    ["L35", "N35", "P35"],
    ["L36", "N36", "P36"],
    ["L37", "N37"],
    ["L38", "N38", "P38"],
    ["L39", "N39", "P39"],
    # Page 2
    ["L48", "N48"],
    ["L49", "N49", "P49"],
    ["L50", "N50"],
    ["L51", "N51"],
    ["L52", "N52"],
    ["L53", "N53", "P53"],
    ["L54", "N54", "P54"],
    ["L55", "N55", "P55"],
    ["L56", "N56", "P56"],
    ["L57", "N57", "P57"],
    ["L59", "N59", "P59"],
    ["L60", "N60", "P60"],
    ["L61", "N61", "P61"],
    ["L62", "N62", "P62"],
    ["L63", "N63", "P63"],
    ["L64", "N64", "P64"],
    ["N65", "P65"],
    ["L67", "N67"],
    ["L68", "N68", "P68"],
    ["L69", "N69", "P69"],
    ["L70", "N70", "P70"],
    ["L71", "N71", "P71"],
    ["L72", "N72", "P72"],
    ["L73", "N73", "P73"],
    ["L74", "N74", "P74"],
    ["L75", "N75", "P75"],
    ["L76", "N76"],
    ["L77", "N77", "P77"],
    ["L78", "N78", "P78"],
    # Page 3
    ["L87", "N87"],
    ["L88", "N88", "P88"],
    ["L89", "N89"],
    ["L90", "N90"],
    ["L91", "N91"],
    ["L92", "N92", "P92"],
    ["L93", "N93", "P93"],
    ["L94", "N94", "P94"],
    ["L95", "N95", "P95"],
    ["L96", "N96", "P96"],
    ["L98", "N98", "P98"],
    ["L99", "N99", "P99"],
    ["L100", "N100", "P100"],
    ["L101", "N101", "P101"],
    ["L102", "N102", "P102"],
    ["L103", "N103", "P103"],
    ["N104", "P104"],
    ["L106", "N106"],
    ["L107", "N107", "P107"],
    ["L108", "N108", "P108"],
    ["L109", "N109", "P109"],
    ["L110", "N110", "P110"],
    ["L111", "N111", "P111"],
    ["L112", "N112", "P112"],
    ["L113", "N113", "P113"],
    ["L114", "N114", "P114"],
    ["L115", "N115"],
    ["L116", "N116", "P116"],
    ["L117", "N117", "P117"],
    # Page 4
    ["L126", "N126"],
    ["L127", "N127", "P127"],
    ["L128", "N128"],
    ["L129", "N129"],
    ["L130", "N130"],
    ["L131", "N131", "P131"],
    ["L132", "N132", "P132"],
    ["L133", "N133", "P133"],
    ["L134", "N134", "P134"],
    ["L135", "N135", "P135"],
    ["L137", "N137", "P137"],
    ["L138", "N138", "P138"],
    ["L139", "N139", "P139"],
    ["L140", "N140", "P140"],
    ["L141", "N141", "P141"],
    ["L142", "N142", "P142"],
    ["N143", "P143"],
    ["L145", "N145"],
    ["L146", "N146", "P146"],
    ["L147", "N147", "P147"],
    ["L148", "N148", "P148"],
    ["L149", "N149", "P149"],
    ["L150", "N150", "P150"],
    ["L151", "N151", "P151"],
    ["L152", "N152", "P152"],
    ["L153", "N153", "P153"],
    ["L154", "N154"],
    ["L155", "N155", "P155"],
    ["L156", "N156", "P156"],
]


MERGE_CELLS_BY_PAGE = [
    MERGE_CELLS[0:39],  # Page 1
    MERGE_CELLS[39:78],  # Page 2
    MERGE_CELLS[78:117],  # Page 3
    MERGE_CELLS[117:],  # Page 4
]

MERGE_CHECKBOX_GROUPS_BY_PAGE = [
    MERGE_CHECKBOX_GROUPS[0:29],  # Page 1
    MERGE_CHECKBOX_GROUPS[29:58],  # Page 2
    MERGE_CHECKBOX_GROUPS[58:87],  # Page 3
    MERGE_CHECKBOX_GROUPS[87:],  # Page 4
]

# Use two meaningful anchor cells per page (like a known header or unique field)
MEANINGFUL_ANCHORS = [
    ["F7", "F8"],  # Page 1
    ["F47", "F48"],  # Page 2
    ["F87", "A88"],  # Page 3
    ["F127", "A128"],  # Page 4
]


def merge_22_CU_Transp(ws_file_list, output_ws):
    for i, (merge_cells_page, checkbox_groups_page) in enumerate(
        zip(MERGE_CELLS_BY_PAGE, MERGE_CHECKBOX_GROUPS_BY_PAGE)
    ):
        anchor_cells = MEANINGFUL_ANCHORS[i]
        if not is_page_meaningful(ws_file_list, anchor_cells):
            print(f"Page {i+1} is blank â€” skipping this and all following pages.")
            break

        merge_cells(ws_file_list, output_ws, merge_cells_page, tech_col_letter="R")
        merge_checkbox_groups(
            ws_file_list, output_ws, checkbox_groups_page, tech_col_letter="R"
        )
